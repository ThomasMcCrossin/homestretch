{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://curlys.ca/schemas/ufile-t2-packet.json",
  "title": "UFile T2 Filing Packet",
  "description": "Structured data for Canadian T2 corporate tax filing via UFile",
  "type": "object",
  "required": ["meta", "entity", "years", "evidence_index"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Metadata about this packet",
      "required": ["schema_version", "generated_at", "snapshot_source"],
      "properties": {
        "schema_version": {
          "type": "string",
          "description": "Version of this schema",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when packet was generated"
        },
        "snapshot_source": {
          "type": "string",
          "description": "Path to the source snapshot used to generate this packet"
        },
        "generator": {
          "type": "string",
          "description": "Tool/process that generated this packet"
        },
        "notes": {
          "type": "string",
          "description": "Free-form notes about this packet"
        }
      }
    },
    "entity": {
      "type": "object",
      "description": "Corporation identification and basic info",
      "required": ["legal_name", "bn", "jurisdiction", "year_end_month_day", "corp_type"],
      "properties": {
        "legal_name": {
          "type": "string",
          "description": "Legal corporation name as registered"
        },
        "operating_name": {
          "type": ["string", "null"],
          "description": "Trade/operating name if different"
        },
        "bn": {
          "type": "string",
          "description": "Business Number (9 digits + RC + 4 digits)",
          "pattern": "^\\d{9}RC\\d{4}$"
        },
        "jurisdiction": {
          "type": "string",
          "description": "Province/territory of incorporation and tax jurisdiction"
        },
        "year_end_month_day": {
          "type": "string",
          "description": "Fiscal year-end (MM-DD format)",
          "pattern": "^(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$"
        },
        "corp_type": {
          "type": "string",
          "enum": ["CCPC", "other_private", "public", "controlled_by_public", "other"],
          "description": "Type of corporation for tax purposes"
        },
        "head_office_address": {
          "type": "object",
          "properties": {
            "street": { "type": "string" },
            "city": { "type": "string" },
            "province": { "type": "string" },
            "postal_code": { "type": "string" },
            "country": { "type": "string", "default": "Canada" }
          }
        },
        "contact": {
          "type": "object",
          "properties": {
            "signing_officer_name": { "type": "string" },
            "signing_officer_title": { "type": "string" },
            "phone": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "alternate_contact_name": { "type": ["string", "null"] },
            "alternate_contact_phone": { "type": ["string", "null"] }
          }
        },
        "shareholders": {
          "type": "array",
          "description": "Shareholders owning 10%+ for Schedule 50",
          "items": {
            "type": "object",
            "required": ["name", "sin_or_bn", "common_pct", "preferred_pct"],
            "properties": {
              "name": { "type": "string" },
              "sin_or_bn": { "type": "string" },
              "common_pct": { "type": "number", "minimum": 0, "maximum": 100 },
              "preferred_pct": { "type": "number", "minimum": 0, "maximum": 100 }
            }
          }
        },
        "naics_code": {
          "type": ["string", "null"],
          "description": "NAICS industry classification code"
        },
        "ufile_screens": {
          "type": "object",
          "description": "Values for non-GIFI UFile screens that must be entered (addresses, tax preparer, officers).",
          "properties": {
            "tax_preparer": {
              "type": "object",
              "properties": {
                "addressee": { "type": ["string", "null"] },
                "position_or_title": { "type": ["string", "null"] },
                "contact_first_name": { "type": ["string", "null"] },
                "contact_last_name": { "type": ["string", "null"] },
                "phone_day": { "type": ["string", "null"] },
                "fax": { "type": ["string", "null"] },
                "rep_id": { "type": ["string", "null"] },
                "email": { "type": ["string", "null"] },
                "street": { "type": ["string", "null"] },
                "city": { "type": ["string", "null"] },
                "province": { "type": ["string", "null"] },
                "postal_code": { "type": ["string", "null"] }
              }
            },
            "head_office_address": {
              "type": "object",
              "properties": {
                "addressee": { "type": ["string", "null"] },
                "street": { "type": ["string", "null"] },
                "city": { "type": ["string", "null"] },
                "province": { "type": ["string", "null"] },
                "postal_code": { "type": ["string", "null"] },
                "contact_person": { "type": ["string", "null"] },
                "phone_day": { "type": ["string", "null"] },
                "fax": { "type": ["string", "null"] },
                "changed_since_last_return": { "type": ["string", "null"] }
              }
            },
            "other_addresses": {
              "type": "object",
              "properties": {
                "mailing": {
                  "type": "object",
                  "properties": {
                    "addressee": { "type": ["string", "null"] },
                    "street": { "type": ["string", "null"] },
                    "city": { "type": ["string", "null"] },
                    "province": { "type": ["string", "null"] },
                    "postal_code": { "type": ["string", "null"] },
                    "contact_person": { "type": ["string", "null"] },
                    "phone_day": { "type": ["string", "null"] },
                    "fax": { "type": ["string", "null"] },
                    "changed_since_last_return": { "type": ["string", "null"] }
                  }
                },
                "books_and_records": {
                  "type": "object",
                  "properties": {
                    "addressee": { "type": ["string", "null"] },
                    "street": { "type": ["string", "null"] },
                    "city": { "type": ["string", "null"] },
                    "province": { "type": ["string", "null"] },
                    "postal_code": { "type": ["string", "null"] },
                    "contact_person": { "type": ["string", "null"] },
                    "phone_day": { "type": ["string", "null"] },
                    "fax": { "type": ["string", "null"] },
                    "changed_since_last_return": { "type": ["string", "null"] }
                  }
                }
              }
            },
            "corporate_officers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "first_name": { "type": ["string", "null"] },
                  "last_name": { "type": ["string", "null"] },
                  "title": { "type": ["string", "null"] },
                  "is_signing_officer": { "type": ["boolean", "null"] },
                  "elected_date": { "type": ["string", "null"] },
                  "ceased_date": { "type": ["string", "null"] },
                  "sin": { "type": ["string", "null"] },
                  "voting_pct": { "type": ["number", "null"] },
                  "common_pct": { "type": ["number", "null"] },
                  "preferred_pct": { "type": ["number", "null"] },
                  "address_street": { "type": ["string", "null"] },
                  "address_city": { "type": ["string", "null"] },
                  "address_province": { "type": ["string", "null"] },
                  "address_postal_code": { "type": ["string", "null"] },
                  "phone_day": { "type": ["string", "null"] },
                  "fax": { "type": ["string", "null"] }
                }
              }
            }
          }
        }
      }
    },
    "years": {
      "type": "object",
      "description": "Per-fiscal-year filing data",
      "additionalProperties": {
        "type": "object",
        "required": ["fiscal_period", "schedule_100", "schedule_125", "retained_earnings", "schedule_1"],
        "properties": {
          "fiscal_period": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": { "type": "string", "format": "date" },
              "end": { "type": "string", "format": "date" },
              "days": { "type": "integer", "minimum": 1, "maximum": 366 },
              "is_first_year": { "type": "boolean" }
            }
          },
          "schedule_100": {
            "type": "object",
            "description": "Balance Sheet GIFI codes",
            "additionalProperties": {
              "type": "object",
              "required": ["amount"],
              "properties": {
                "amount": { "type": "integer", "description": "Whole dollars, rounded" },
                "label": { "type": "string" },
                "note": { "type": ["string", "null"] }
              }
            }
          },
          "schedule_125": {
            "type": "object",
            "description": "Income Statement GIFI codes",
            "additionalProperties": {
              "type": "object",
              "required": ["amount"],
              "properties": {
                "amount": { "type": "integer" },
                "label": { "type": "string" },
                "note": { "type": ["string", "null"] }
              }
            }
          },
          "retained_earnings": {
            "type": "object",
            "description": "Retained earnings schedule (GIFI 3660-3849)",
            "additionalProperties": {
              "type": "object",
              "required": ["amount"],
              "properties": {
                "amount": { "type": "integer" },
                "label": { "type": "string" }
              }
            }
          },
          "schedule_1": {
            "type": "object",
            "description": "Net Income Reconciliation for Tax Purposes",
            "additionalProperties": {
              "type": "object",
              "required": ["amount"],
              "properties": {
                "amount": { "type": "integer" },
                "label": { "type": "string" },
                "calculation": { "type": ["string", "null"], "description": "How this was derived" }
              }
            }
          },
          "schedule_8": {
            "type": "object",
            "description": "Capital Cost Allowance (Schedule 8)",
            "properties": {
              "classes": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "required": ["class", "opening_ucc", "additions", "cca_claim", "closing_ucc"],
                  "properties": {
                    "class": { "type": "string" },
                    "description": { "type": ["string", "null"] },
                    "rate": { "type": ["number", "null"] },
                    "opening_ucc": { "type": "integer" },
                    "additions": { "type": "integer" },
                    "dispositions": { "type": "integer" },
                    "half_year_base": { "type": "integer" },
                    "cca_claim": { "type": "integer" },
                    "closing_ucc": { "type": "integer" }
                  }
                }
              },
              "assets": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "asset_id": { "type": "string" },
                    "description": { "type": ["string", "null"] },
                    "cca_class": { "type": ["string", "null"] },
                    "available_for_use_date": { "type": ["string", "null"], "format": "date" },
                    "total_cost_cents": { "type": ["integer", "null"] },
                    "total_cost_dollars": { "type": ["integer", "null"] },
                    "claim_percent_of_max": { "type": ["string", "null"] },
                    "half_year_rule": { "type": ["string", "null"] },
                    "source_breakdown": { "type": ["string", "null"] }
                  }
                }
              },
              "summary": {
                "type": "object",
                "properties": {
                  "total_additions": { "type": "integer" },
                  "total_cca_claim": { "type": "integer" },
                  "classes_used": { "type": "array", "items": { "type": "string" } }
                }
              },
              "note": { "type": ["string", "null"] }
            }
          },
          "book_fixed_assets": {
            "type": "array",
            "description": "Book fixed-asset overlay audit rows",
            "items": {
              "type": "object",
              "properties": {
                "asset_id": { "type": "string" },
                "description": { "type": ["string", "null"] },
                "book_treatment": { "type": ["string", "null"] },
                "book_depr_policy": { "type": ["string", "null"] },
                "book_start_date": { "type": ["string", "null"], "format": "date" },
                "available_for_use_date": { "type": ["string", "null"], "format": "date" },
                "total_cost_cents": { "type": ["integer", "null"] },
                "total_cost_dollars": { "type": ["integer", "null"] },
                "reclass_total_cents": { "type": ["integer", "null"] },
                "reclass_total_dollars": { "type": ["integer", "null"] },
                "amortization_cents": { "type": ["integer", "null"] },
                "amortization_dollars": { "type": ["integer", "null"] },
                "book_asset_gifi_code": { "type": ["string", "null"] },
                "book_accum_amort_gifi_code": { "type": ["string", "null"] },
                "book_amort_expense_gifi_code": { "type": ["string", "null"] },
                "component_breakdown": { "type": ["string", "null"] },
                "source_breakdown": { "type": ["string", "null"] },
                "notes": { "type": ["string", "null"] }
              }
            }
          },
          "positions": {
            "type": "object",
            "description": "Key tax positions and accounting policies for this year",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "value": { "type": ["string", "boolean", "number", "null"] },
                "note": { "type": ["string", "null"] },
                "evidence": { "type": ["string", "null"] }
              }
            }
          },
          "cross_checks": {
            "type": "array",
            "description": "Validation checks that must pass",
            "items": {
              "type": "object",
              "required": ["description", "expected", "actual", "status"],
              "properties": {
                "description": { "type": "string" },
                "expected": { "type": ["string", "number"] },
                "actual": { "type": ["string", "number"] },
                "status": { "type": "string", "enum": ["PASS", "FAIL", "WARN"] },
                "note": { "type": ["string", "null"] }
              }
            }
          },
          "ufile_screens": {
            "type": "object",
            "description": "Values for year-specific UFile screens (identification, refund/balance owing, etc.).",
            "properties": {
              "corporate_history": {
                "type": "object",
                "description": "UFile Corporate History screen (typically only the 1st prior year row is used).",
                "properties": {
                  "has_entries": { "type": ["boolean", "null"] },
                  "prior_year_end_date": { "type": ["string", "null"], "format": "date" },
                  "prior_year_taxable_income": { "type": ["integer", "null"] },
                  "prior_year_claimed_sbd": { "type": ["boolean", "null"] },
                  "prior_year_large_corp_amount_line_415": { "type": ["integer", "null"] },
                  "prior_year_taxable_paid_up_capital": { "type": ["integer", "null"] },
                  "prior_year_total_assets_gifi_2599": { "type": ["integer", "null"] },
                  "eligible_rdtoh_end_prior_year": { "type": ["integer", "null"] },
                  "non_eligible_rdtoh_end_prior_year": { "type": ["integer", "null"] },
                  "eligible_dividend_refund_prior_year": { "type": ["integer", "null"] },
                  "non_eligible_dividend_refund_prior_year": { "type": ["integer", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "identification_of_corporation": {
                "type": "object",
                "properties": {
                  "one_month_extension_balance_due": { "type": ["boolean", "null"] },
                  "charter_jurisdiction": { "type": ["string", "null"] },
                  "incorporation_date": { "type": ["string", "null"] },
                  "operations_start_date": { "type": ["string", "null"] },
                  "is_first_federal_return": { "type": ["boolean", "null"] },
                  "is_final_federal_return": { "type": ["boolean", "null"] },
                  "permanent_establishment_province": { "type": ["string", "null"] },
                  "language_of_correspondence": { "type": ["string", "null"] },
                  "email": { "type": ["string", "null"] },
                  "activity_status": { "type": ["string", "null"] },
                  "activity_description": { "type": ["string", "null"] },
                  "naics_code": { "type": ["string", "null"] },
                  "principal_products": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "description": { "type": ["string", "null"] },
                        "percent_of_revenue": { "type": ["number", "null"] }
                      }
                    }
                  },
                  "has_gifi_financials": { "type": ["boolean", "null"] },
                  "internet_business": {
                    "type": "object",
                    "properties": {
                      "earns_income": { "type": ["boolean", "null"] },
                      "number_of_sites": { "type": ["integer", "null"] },
                      "percent_gross_revenue_from_internet": { "type": ["number", "null"] },
                      "top_urls": { "type": "array", "items": { "type": "string" } }
                    }
                  },
                  "quarterly_installments": {
                    "type": "object",
                    "properties": {
                      "wants_consideration": { "type": ["boolean", "null"] },
                      "perfect_compliance_history": { "type": ["boolean", "null"] }
                    }
                  }
                }
              },
              "refund_or_balance_owing": {
                "type": "object",
                "properties": {
                  "tax_payment_code": { "type": ["string", "null"] },
                  "refund_code": { "type": ["string", "null"] }
                }
              },
              "dividends_paid": {
                "type": "object",
                "description": "UFile Dividends paid screen (taxable/non-taxable dividend panels).",
                "properties": {
                  "has_dividends": { "type": ["boolean", "null"] },
                  "taxable_dividends_paid": { "type": ["integer", "null"], "description": "Whole dollars" },
                  "eligible_dividend_portion": { "type": ["integer", "null"], "description": "Whole dollars (portion of taxable dividends that are eligible)" },
                  "capital_dividends": { "type": ["integer", "null"], "description": "Whole dollars" },
                  "capital_gains_dividend": { "type": ["integer", "null"], "description": "Whole dollars" },
                  "note": { "type": ["string", "null"] }
                }
              },
              "general_rate_income_pool": {
                "type": "object",
                "description": "UFile GRIP (General rate income pool) screen. Often required if eligible dividends are designated.",
                "properties": {
                  "grip_end_prior_year": { "type": ["integer", "null"], "description": "Whole dollars" },
                  "amount_respecting_dividends": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "selection": { "type": ["string", "null"] },
                        "amount": { "type": ["integer", "null"] }
                      }
                    }
                  },
                  "specified_future_tax_consequences_before": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "selection": { "type": ["string", "null"] },
                        "amount": { "type": ["integer", "null"] }
                      }
                    }
                  },
                  "specified_future_tax_consequences_after": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "selection": { "type": ["string", "null"] },
                        "amount": { "type": ["integer", "null"] }
                      }
                    }
                  },
                  "elected_excessive_eligible_dividend_designation_as_ordinary": { "type": ["integer", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "transactions_with_shareholders_officers_employees": {
                "type": "object",
                "description": "Disclosure screen: summarize that transactions exist (dividends, reimbursements, shareholder loan).",
                "properties": {
                  "note": { "type": ["string", "null"] }
                }
              },
              "losses": {
                "type": "object",
                "properties": {
                  "has_loss_carryforwards": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "charitable_donations": {
                "type": "object",
                "properties": {
                  "has_donations": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "reserves": {
                "type": "object",
                "properties": {
                  "has_reserves": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "capital_cost_allowance": {
                "type": "object",
                "properties": {
                  "has_cca": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "book_fixed_assets": {
                "type": "object",
                "properties": {
                  "has_book_fixed_assets": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "non_depreciable_capital_property": {
                "type": "object",
                "properties": {
                  "has_property": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "deferred_income_plans": {
                "type": "object",
                "properties": {
                  "has_plans": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              },
              "status_change_for_corporation": {
                "type": "object",
                "properties": {
                  "has_status_change": { "type": ["boolean", "null"] },
                  "note": { "type": ["string", "null"] }
                }
              }
            }
          }
        }
      }
    },
    "global_positions": {
      "type": "object",
      "description": "Positions/elections that apply across all years",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "value": { "type": ["string", "boolean", "number", "null"] },
          "note": { "type": ["string", "null"] },
          "evidence": { "type": ["string", "null"] }
        }
      }
    },
    "evidence_index": {
      "type": "array",
      "description": "Index of evidence files supporting this packet",
      "items": {
        "type": "object",
        "required": ["category", "path", "description"],
        "properties": {
          "category": {
            "type": "string",
            "enum": ["GIFI", "payroll", "HST", "tips", "inventory", "shareholder", "bank", "other"]
          },
          "path": { "type": "string" },
          "description": { "type": "string" },
          "fiscal_year": { "type": ["string", "null"] }
        }
      }
    },
    "known_judgments": {
      "type": "array",
      "description": "Documented estimates, judgments, or assumptions",
      "items": {
        "type": "object",
        "required": ["area", "description", "approach"],
        "properties": {
          "area": { "type": "string" },
          "description": { "type": "string" },
          "approach": { "type": "string" },
          "evidence": { "type": ["string", "null"] },
          "risk_level": { "type": "string", "enum": ["low", "medium", "high"] }
        }
      }
    }
  }
}
