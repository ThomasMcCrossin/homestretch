# UFile T2 Filing Packet

A structured, deterministic, and reusable package for Canadian T2 corporate tax filing via UFile.

---

## What This Packet Is

This packet stores all filing values, positions, and supporting documentation for T2 corporate tax returns in a structured format that can be:

1. **Regenerated** from source accounting snapshots without touching the accounting database
2. **Validated** against schema and cross-check rules
3. **Compared** to prior year filings for consistency
4. **Used** to generate operator-friendly fill guides for UFile

---

## Directory Structure

```
UfileToFill/ufile_packet/
├── README.md                          # This file
├── packet.json                        # Main data file (source of truth)
├── schema/
│   └── packet_schema.json             # JSON schema for validation
├── tables/
│   ├── schedule_100_FY2024.csv        # Schedule 100 entry lines (totals omitted)
│   ├── schedule_100_FY2025.csv
│   ├── schedule_125_FY2024.csv        # Schedule 125 entry lines (COGS via 8300/8320/8500; totals omitted)
│   ├── schedule_125_FY2025.csv
│   ├── schedule_1_FY2024.csv          # Net income reconciliation
│   ├── schedule_1_FY2025.csv
│   └── positions_and_notes.csv        # Key positions/elections
├── guides/
│   └── UFILet2_FILL_GUIDE_FROM_PACKET.md  # Second-screen fill guide
├── diffs/
│   └── COMPARE_2023_FILED_VS_PACKET.md    # Comparison with prior filing
├── prompts/
│   ├── PROMPT_BUILD_PACKET.md         # LLM prompt to build/update packet
│   └── PROMPT_PRE_FILE_REVIEW.md      # LLM prompt for pre-file audit
└── tools/
    └── (optional Python scripts)
```

---

## Critical Warnings

### DO NOT EDIT THE ACCOUNTING DATABASE
This packet is a **read-only derivative** of the accounting data. Never modify:
- `db/t2_final.db`
- Any files in `output/` that are generated by the accounting pipeline
- Imported Wave/CRA/payroll exports

### To Update Values
1. Fix the source data in the accounting pipeline
2. Generate a new snapshot
3. Regenerate `packet.json` from the new snapshot
4. Regenerate CSVs and guides from the new `packet.json`

---

## How to Use

### For Filing (Operator Workflow)

1. Open the year-specific guide on a second screen:
   - `years/FY2024/UFILet2_FILL_GUIDE.md`
   - `years/FY2025/UFILet2_FILL_GUIDE.md`
2. Open UFile T2
3. Enter values from the guide into UFile
4. Cross-reference GIFI codes and amounts
5. Verify UFile's calculated totals match the guide's totals

### For Updating the Packet

1. Run the accounting pipeline to generate a new snapshot
2. Use `prompts/PROMPT_BUILD_PACKET.md` with an LLM or manual process
3. Validate the new `packet.json` against the schema
4. Regenerate CSVs and guides

### For Pre-File Review

1. Use `prompts/PROMPT_PRE_FILE_REVIEW.md` with an LLM
2. Address any CRITICAL or HIGH priority items
3. Document defense strategies for audit risks
4. File with confidence

---

## Regenerating Files

### Refresh packet + rebuild guides from the latest snapshot (recommended)
```bash
python3 UfileToFill/ufile_packet/tools/refresh_from_latest_snapshot.py
```

If you want to pin to a specific snapshot:
```bash
python3 UfileToFill/ufile_packet/tools/refresh_from_latest_snapshot.py --snapshot output/snapshots/20260129-192249
```

### Validate packet vs snapshot
```bash
python3 UfileToFill/ufile_packet/tools/validate_packet.py
```

### Build per-year guides/packets (UFile is filed one year at a time)
```bash
python3 UfileToFill/ufile_packet/tools/build_year_artifacts.py
```

### Regenerate CSVs from packet.json
```bash
# Example Python script (tools/build_csvs.py)
import json
import csv

with open('packet.json') as f:
    packet = json.load(f)

for year, data in packet['years'].items():
    # Write Schedule 100
    with open(f'tables/schedule_100_{year}.csv', 'w', newline='') as f:
        writer = csv.writer(f)
        writer.writerow(['GIFI_Code', 'Description', 'Amount', 'Note'])
        for gifi, vals in data['schedule_100'].items():
            writer.writerow([gifi, vals['label'], vals['amount'], vals.get('note', '')])
```

### Validate Against Schema
```bash
# Using jsonschema Python package
pip install jsonschema
python -c "
import json
from jsonschema import validate
with open('schema/packet_schema.json') as f:
    schema = json.load(f)
with open('packet.json') as f:
    packet = json.load(f)
validate(packet, schema)
print('Validation passed!')
"
```

---

## For Future Years/Clients

### To Reuse This Structure

1. Copy the entire `ufile_packet/` directory to a new project
2. Clear year-specific data from `packet.json`
3. Update `entity` section with new client information
4. Follow `prompts/PROMPT_BUILD_PACKET.md` to populate from new snapshot
5. Regenerate all derivative files

### To Add a New Fiscal Year

1. Add a new key to `packet.json` under `years` (e.g., "FY2026")
2. Follow the same structure as existing years
3. Update evidence_index with new file references
4. Regenerate CSVs and guides

---

## Evidence Traceability

Every value in `packet.json` should be traceable to a source file. The `evidence_index` array lists all source files used. For specific line items, check the `note` fields which often include file references.

Key evidence files:
- **GIFI schedules**: `output/snapshots/.../output/gifi_schedule_*.csv`
- **Trial balances**: `output/snapshots/.../output/trial_balance_*.csv`
- **Shareholder info**: `docs/SHAREHOLDER_EQUITY_POSITION.md`
- **Prior filings**: `data/2023 - 14587430 Canada Inc..pdf`

---

## Schema Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-01-27 | Initial release |

---

## Contact / Support

This packet was created for 14587430 Canada Inc. (Curly's Canteen).
For questions about the data or methodology, refer to the evidence files or the original accounting repository.

---

*This packet is designed for Canadian T2 corporate tax filing. It does not constitute tax advice. Consult a licensed accountant for professional guidance.*
